(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function i(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=i(o);fetch(o.href,n)}})();async function N(t){try{const e=await navigator.mediaDevices.getUserMedia({video:!0});return t.srcObject=e,await t.play(),e}catch(e){throw console.error("camera access error:",e),e}}function O(t,e,i,{mimeType:s="video/webm"}={}){const o=["video/webm; codecs=vp8","video/webm; codecs=vp9","video/webm","video/mp4"];let n=null;for(const r of o)if(MediaRecorder.isTypeSupported(r)){n=r;break}if(!n)return console.error("No supported MIME types are available for MediaRecorder."),null;console.log(`Using MIME type: ${n}`);const c=new MediaRecorder(t,{mimeType:n});let a=[];return c.ondataavailable=r=>{console.log("Data chunk received:",r.data),r.data&&r.data.size>0?(a.push(r.data),e(r.data)):console.warn("Received empty or invalid chunk.")},c.onstop=()=>{if(console.log("Chunks collected:",a),!Array.isArray(a)||a.length===0){console.error("No data chunks available."),i(null);return}try{const r=new Blob(a,{type:n});console.log("Blob created successfully:",r),i(r),a=[]}catch(r){console.error("Error during Blob creation:",r),i(null)}},c}function C(t,e){const i=e.getContext("2d");return e.width=t.videoWidth,e.height=t.videoHeight,i.drawImage(t,0,0,e.width,e.height),e.toDataURL("image/png")}function q(t,e,i,s,o,n,c,a){let r=!1,f;function m(p){p.preventDefault(),r=!1,f=setTimeout(()=>{r=!0,e&&e.state==="inactive"?c():console.warn("MediaRecorder is not inactive:",e==null?void 0:e.state)},500)}function h(p){if(p.preventDefault(),clearTimeout(f),r)e&&e.state==="recording"?a():console.warn("MediaRecorder is not recording:",e==null?void 0:e.state);else{const b=i();s.style.display="flex";const M=s.querySelector("img"),S=s.querySelector("video");M.src=b,M.style.display="block",S.style.display="none",o.onclick=()=>{const v=document.createElement("a");v.href=b,v.download="capture.png",v.click()}}}function w(p){p.preventDefault(),clearTimeout(f),r&&e&&e.state==="recording"&&a()}t.addEventListener("mousedown",m),t.addEventListener("mouseup",h),t.addEventListener("mouseleave",w),t.addEventListener("touchstart",m,{passive:!1}),t.addEventListener("touchend",h,{passive:!1}),t.addEventListener("touchcancel",w,{passive:!1}),n.onclick=()=>{s.style.display="none"}}function A(t,e){if(!t||!(t instanceof Blob)||t.size===0){console.error("Blob is invalid or undefined. Cannot create video preview."),console.error("Received blob:",t);return}if(!e){console.error("Preview container is not defined or missing in the DOM.");return}const i=URL.createObjectURL(t);let s=e.querySelector(".video-box");s||(s=document.createElement("div"),s.className="video-box",e.appendChild(s)),s.innerHTML="";const o=document.createElement("video");o.src=i,o.controls=!0,o.loop=!0,o.autoplay=!0,o.playsInline=!0,Object.assign(o.style,{width:"100%",maxHeight:"300px",display:"block"}),s.appendChild(o);const n=e.querySelector(".preview-actions");n?n.style.display="flex":console.warn("No .preview-actions element found in container."),e.style.display="flex"}function H(t,e,i,s){const o=t.querySelector(".preview-actions");o&&(o.style.display="flex"),e.onclick=()=>{const n=t.querySelector("img, video");if(n){const c=n.src;n.tagName;const a=n.tagName==="IMG"?"capture.png":"recording.webm",r=document.createElement("a");r.href=c,r.download=a,r.click()}},i.onclick=async()=>{const n=t.querySelector("img, video");if(n&&navigator.share)try{const c=n.src,a=n.tagName==="IMG"?"image/png":"video/webm",r=await fetch(c).then(m=>m.blob()),f=new File([r],a==="image/png"?"capture.png":"recording.webm",{type:a});await navigator.share({files:[f],title:"Check out my media!"})}catch(c){console.error("Error sharing media:",c),alert("Failed to share the media.")}else alert("Web Share API is not supported on this device.")},s.onclick=()=>{t.style.display="none"}}const E=document.getElementById("camera-stream"),U=document.getElementById("capture-canvas"),d=document.getElementById("record-btn"),$=document.getElementById("share-btn"),y=document.getElementById("preview-container"),L=document.getElementById("download-btn"),P=document.getElementById("close-preview-btn"),g=document.querySelector(".progress-ring__circle"),k=document.getElementById("timer");let l,I=[],T,x;const _=g.r.baseVal.value,u=2*Math.PI*_;g.style.strokeDasharray=`${u} ${u}`;g.style.strokeDashoffset=u;function B(t){const e=u-t/100*u;g.style.strokeDashoffset=e}function j(){const t=Math.floor((Date.now()-T)/1e3),e=String(Math.floor(t/60)).padStart(2,"0"),i=String(t%60).padStart(2,"0");k.textContent=`${e}:${i}`;const s=60,o=Math.min(t/s*100,100);B(o),t>=s&&D()}function F(){l&&l.state==="inactive"&&(l.start(),T=Date.now(),x=setInterval(j,1e3),d.classList.add("recording"),d.innerHTML='<i class="fas fa-stop-circle"></i>')}function D(){l&&l.state==="recording"&&(l.stop(),clearInterval(x),k.textContent="00:00",B(u),d.classList.remove("recording"),d.innerHTML='<i class="fas fa-circle"></i>')}async function G(){if(!l)try{const t=await N(E);l=O(t,e=>I.push(e),e=>{e?(A(e,y),y.style.display="flex"):alert("録画データの取得に失敗しました。"),I=[]},{mimeType:"video/webm"}),q(d,l,()=>C(E,U),y,L,P,F,D)}catch(t){console.error("カメラのセットアップに失敗しました:",t),alert("カメラへのアクセスが拒否されました。");return}}d.addEventListener("click",G);H(y,L,$,P);
